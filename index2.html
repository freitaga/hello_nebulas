<!DOCTYPE html>
<html>
<head>
<title>Nebulas</title>

<style type="text/css">
	#banner{
		width: 100%;
		height: 30vh;
	}

	.input{
		font-size: 30px;
	}


</style>
<link type="text/css" href="main.css" rel="stylesheet" media="screen" />
</head>
<body>


<img src="nebulas.jpeg" id="banner" >

<!-- style=" background-image:url(img/bgcandy.jpg);width:100%; height: 100vh;margin:auto; padding:0;display:block;" -->
<div  >

<!-- <form id="form" style = " height: 100vh; font-size: 30pt; text-align: center; border: 30px solid transparent; border-image:url(img/border1.png) 30 round; border-style: solid; background-color: #6564fb;  "> -->
	Guest Name:
	<br>
	<input type="text" name="name" maxlength="24" id="name" class="input"> 
	<br>
	Location
	<br>
	<input type="text" name="location" maxlength="24" id="location"  class="input"> 
	<br>
	Message:
	<br>
	<textarea rows="4" cols="50" style="resize:none;" maxlength="512" id="message"  class="input">
		
	</textarea>
	<br>
	<input type="button" value="Submit"  id="submit" >
	<!-- <input type="text" name="message" maxlength="512" size="35" height="100px" > -->
<!--</form> -->

</div>

<div id="book">
	<canvas id="pageflip-canvas"></canvas>
	<div id="pages">
		<section id="page1">
			<div id="page1content">
				<h2>History</h2>
				
			</div>
		</section>
	</div>
</div>

	
<ul id="list">
	

</ul>


<script>

</script>

<script src=lib/jquery-3.3.1.min.js></script>
<script src=lib/nebPay.js></script>
<script src=lib/bootstrap-4.0.0-dist/js/bootstrap.min.js></script>
<script type="text/javascript" src="pageflip.js"></script>
<!-- js -->

<script type="text/javascript">

//redirect to guestbook after signing guestbook
/*
window.onload=function() 
{
  document.getElementById("form").onsubmit=function()
  {
    window.location.replace("guestbook.html");
    return false;
  }
}*/
	
var NebPay = require("nebpay");     //https://github.com/nebulasio/nebPay
var nebPay = new NebPay();

$("#search_value").attr("disabled",true)
$("#submit").attr("disabled",true)


//to check if the extension is installed
//if the extension is installed, var "webExtensionWallet" will be injected in to web page
if(typeof(webExtensionWallet) === "undefined"){
    //alert ("Extension wallet is not installed, please install it first.")
    $("#noExtension").removeClass("hide")
}else{
    $("#search_value").attr("disabled",false)
    $("#submit").attr("disabled",false)
}

var dappAddress = "n1rVfyDYFn4tEbTgp85nKxR5scoKJTyZ2pW";

document.getElementById("submit").onclick = function(){
    // $("#search_value").val() 搜索框内的值
    /*
    var to = dappAddress;
    var value = "0";
    var callFunction = "keep";
    var callArgs = "[\"" + "\"user\"" + "," + "\"message\"" + "\"]"; //in the form of ["args"]
    console.log(callArgs);
    nebPay.call(to, value, callFunction, callArgs, {    
        callback: partyTime
	}) ;*/
}

function updateBook(response) {
	console.log("Its time to party");
	console.log(response);

    var result = response.result;

    console.log(result);

    console.log(JSON.parse(result));

    var entries = JSON.parse(result);
    var entry;
    var entryList = [];

    for(var i = 0; i < entries.length; i++) {
    	if(i % 3 == 0){
    		fillPage(entryList);
    		entryList = [];
		}
    	entry = entries[i].key;
    	entryList.push(entry);
    }

    refresh();
}

function generateEntry(entry) {
	console.log("generating entry: " + entry);
	var entry = $( "<p/>").append( entry.text1 + "<br>" + entry.text2 + "<br>" + entry.text3 );
	return entry;
}

function generatePage() {
	var page = $("<section/>")
	return page;
}

function fillPage(entries) {
	var entry;
	var page = generatePage();
	var container = $("<div/>");

	for(var i = 0; i < entries.length; i++) {
    	entry = generateEntry(entries[i]);
    	console.log(entry);
    	container.append(entry);
    	console.log(page);
    }
    page.append(container);

    $("#pages").append(page);
}


// 
document.getElementById("submit").onclick = function()
{
    //var response = JSON.parse();

   

    /*

    {"result":"[{\"key\":{\"text1\":\"hello\",\"text2\":\"nebulas\",\"text3\":\"n1bQQmGnXstHREG7YccNE1XXgQwWU6f7eHh\"}}, {\"key\":{\"text1\":\"hello\",\"text2\":\"nebulas\",\"text3\":\"n1bQQmGnXstHREG7YccNE1XXgQwWU6f7eHh\"}}, {\"key\":{\"text1\":\"hello\",\"text2\":\"nebulas\",\"text3\":\"n1bQQmGnXstHREG7YccNE1XXgQwWU6f7eHh\"}}, {\"key\":{\"text1\":\"hello\",\"text2\":\"nebulas\",\"text3\":\"n1bQQmGnXstHREG7YccNE1XXgQwWU6f7eHh\"}}, {\"key\":{\"text1\":\"hello\",\"text2\":\"nebulas\",\"text3\":\"n1bQQmGnXstHREG7YccNE1XXgQwWU6f7eHh\"}}, {\"key\":{\"text1\":\"hello\",\"text2\":\"nebulas\",\"text3\":\"n1bQQmGnXstHREG7YccNE1XXgQwWU6f7eHh\"}}, {\"key\":{\"text1\":\"helalo\",\"text2\":\"nebulass\",\"text3\":\"n1bQQmGnXstHREG7YccNE1XXgQwWU6f7eHh\"}}]","execute_err":"","estimate_gas":"20316"}

    */
    /*
    console.log(response);

    var result = response.result;

    console.log(result);

    console.log(JSON.parse(result));

    var entries = JSON.parse(result);
    var entry;
    var entryList = [];

    for(var i = 0; i < entries.length; i++) {
    	if(i % 3 == 0){
    		fillPage(entryList);
    		entryList = [];
		}
    	entry = entries[i].key;
    	entryList.push(entry);
    }*/

	//$( "#page1content" ).append( "<p>" + entry.text1 + "</p>" );
	//$( "#page1content" ).append( "<p>" + entry.text2 + "</p>" );
	//$( "#page1content" ).append( "<p>" + entry.text3 + "</p>" );

	$( "#page1content" ).append( "<p>" + "AlexF" + " " + "Hello Nebulas!" + " " + "8s8fds9dfg8ghdfg89" + "</p>" );


	refresh();
    //console.log(data);

    console.log("test");
    //console.log(response);
    
    
	var to = dappAddress;
    var value = "0";
    var callFunction = "iterate";
    var callArgs = "[" + 20 + "," +  0 + "]"; //in the form of ["args"]
    console.log(callArgs);
    nebPay.simulateCall(to, value, callFunction, callArgs, {    
        callback: updateBook
	});

    var text = document.getElementById("message").value; //.value gets input values
    var name = document.getElementById("name").value;
    var location = document.getElementById("location").value;
   
    /*
    var entry = { 'name':name, 'location':location, 'message':text};
    var entries = JSON.parse(localStorage.getItem('entries') || "[]");

    entries.push(entry);

    // later also check for valid entries
    
    // type clear in name to clear local storage
    if(entry.name == "clear")
    {
    	localStorage.removeItem('entries');
    }
    else if(entries.length > 0)
    {
    	localStorage.setItem('entries', JSON.stringify(entries));
    }*/
    

}

</script>

</body>
</html>